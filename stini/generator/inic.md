# inic.pl 使用说明

该脚本将一个与 ini 配置文件相映射的 .h 简易头文件，扩展宏生成包含实现的 .hpp
文件。因为采用模板泛型，不能生成独立的 .cpp 文件。如果固定使用某个 ini 解析器
，则可考虑独立拆分的 .cpp 文件。

标准 `ini.h` 头文件格式，就是规范的 C++ struct 定义样式。因采用 perl 正则解析
，须符合规范写法，不是任意合法的 C++ 自由语法。样式如下：

```cpp
struct SomeIniSection
{
  int keya;
  double keyb;
  std::string keyc;
  long keyd;
  float keye;
  int keyf = 2;
  double keyg = 100.0;

  END_INI_KEY;
};
```

关键点：

* 用户定义的 ini 映射结构体应包含库头文件 `stini.hpp`
* 以 struct 定义，而不用 class;
* 每行定义一个键，主要支持 int/double/string 三种类型。
* 可以使用 = 号表示初始默认值，用于缺省配置项。这也是符合 C++11 初始化语法的。
  但脚本会统一改成传统语法，默认值移入生成的构造函数中。没有初始值的 int 与
  double 类型也会初始化为零值。string 是对象，也会有其默认构造函数。
* 用 `END_INI_KEY` 宏表示定义结束。该宏在 C++ 库 `stini.hpp` 中个有效的空宏，
  而该脚本将为扩展生成几个必备函数：
  + 构造函数，为每个键生成合理初始值
  + 析构函数，如果某个成员是指针（主要是 ini 的每节可能定义为指针容易表示整节
    不需要，节中的字段一般不会定义成指针），需要析构函数。
  + 读取函数 `ReadIni` 从解析器读取数据映射到结构体。实现其实也简单，就是为每
    个字段调用一个函数（宏）。

用法：

* 脚本从标准读入，或从命令行参数中的文件读入，向标准输出，除了展开
  `END_INI_KEY` 宏外，其余内容原样输出。
* 如需保存文件，请使用重定向。如 `inic.pl ini.h > ini.hpp`
* 请勿重定向至输入文件自身，欲实现原位修改，可能需要再封装一个 shell 脚本。
